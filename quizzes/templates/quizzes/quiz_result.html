{% extends "quizzes/base_quiz.html" %}
{% load static %}

{% block title %}Resultado - {{ quiz.title }}{% endblock %}

{% block extra_styles %}
<style>
    /* Force main content to be full width without default padding */
    body > .main-content {
        padding: 0 !important;
        margin: 0 !important;
        max-width: none !important;
    }

    /* Breadcrumb - Full Width */
    .breadcrumb {
        background: white;
        padding: 1rem 0;
        border-bottom: 1px solid #e5e7eb;
        margin: 0;
        width: 100%;
    }

    .breadcrumb-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 2rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
        font-size: 0.875rem;
    }

    .breadcrumb-link {
        color: #3b82f6;
        text-decoration: none;
        transition: color 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .breadcrumb-link:hover {
        color: #2563eb;
    }

    .breadcrumb-separator {
        color: #9ca3af;
        user-select: none;
    }

    .breadcrumb-current {
        color: #6b7280;
    }

    /* Result Hero Section - Full Width */
    .result-hero {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        padding: 4rem 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
        width: 100%;
        margin: 0;
    }

    .result-hero.excellent {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .result-hero.good {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    }

    .result-hero.poor {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }

    .result-hero.very-poor {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }

    .result-hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        opacity: 0.3;
    }

    .result-hero-content {
        max-width: 1200px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
    }

    .result-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        animation: bounce 1s ease-in-out;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-20px); }
    }

    .result-title {
        font-size: 2.5rem;
        font-weight: 800;
        color: white;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .result-subtitle {
        font-size: 1.125rem;
        color: rgba(255, 255, 255, 0.95);
        margin-bottom: 2rem;
    }

    .score-display {
        display: inline-block;
        background: white;
        color: #1f2937;
        padding: 1.5rem 3rem;
        border-radius: 20px;
        font-size: 4rem;
        font-weight: 800;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        margin-bottom: 1rem;
    }

    .score-label {
        color: white;
        font-size: 1rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        opacity: 0.95;
    }

    /* Content Wrapper */
    .content-wrapper {
        max-width: 1200px;
        margin: 0 auto;
        padding: 3rem 2rem;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        border-color: #e5e7eb;
    }

    .stat-card-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .stat-icon {
        width: 56px;
        height: 56px;
        background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.75rem;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }

    .stat-icon.rank {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
    }

    .stat-icon.users {
        background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
        box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
    }

    .stat-icon.beat {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }

    .stat-content {
        flex: 1;
    }

    .stat-label {
        font-size: 0.875rem;
        color: #6b7280;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.25rem;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 800;
        color: #1f2937;
        line-height: 1;
    }

    .stat-badge {
        display: inline-block;
        padding: 0.5rem 1rem;
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 700;
        color: #92400e;
        margin-top: 0.75rem;
    }

    .stat-badge.top3 {
        background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%);
        color: #92400e;
    }

    .stat-badge.top10 {
        background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%);
        color: #1e40af;
    }

    .stat-badge.average {
        background: linear-gradient(135deg, #d1fae5 0%, #6ee7b7 100%);
        color: #065f46;
    }

    /* Review Section */
    .review-section {
        background: white;
        border-radius: 20px;
        padding: 2.5rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        margin-top: 2rem;
        margin-bottom: 2rem;
    }

    .review-header {
        text-align: center;
        margin-bottom: 2.5rem;
    }

    .review-title {
        font-size: 1.75rem;
        font-weight: 800;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .review-description {
        color: #6b7280;
        font-size: 1rem;
    }

    .question-card {
        background: #f9fafb;
        border: 2px solid #e5e7eb;
        border-radius: 16px;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
        overflow: hidden;
    }

    .question-card:hover {
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
    }

    .question-card.correct {
        border-color: #10b981;
        background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
    }

    .question-card.incorrect {
        border-color: #ef4444;
        background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
    }

    .question-header {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1.5rem 2rem;
        cursor: pointer;
        user-select: none;
    }

    .question-header:hover {
        background: rgba(0, 0, 0, 0.02);
    }

    .question-number {
        flex-shrink: 0;
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 800;
        font-size: 1.125rem;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }

    .question-text {
        flex: 1;
        font-size: 1.125rem;
        font-weight: 700;
        color: #1f2937;
        line-height: 1.5;
    }

    .question-status {
        flex-shrink: 0;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 700;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .question-status.correct {
        background: #10b981;
        color: white;
    }

    .question-status.incorrect {
        background: #ef4444;
        color: white;
    }

    .question-toggle {
        flex-shrink: 0;
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: rgba(59, 130, 246, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        transition: all 0.3s ease;
        color: #3b82f6;
    }

    .question-card.expanded .question-toggle {
        transform: rotate(180deg);
    }

    .question-content {
        display: grid;
        grid-template-rows: 0fr;
        overflow: hidden;
        transition: grid-template-rows 0.3s ease, padding 0.3s ease;
        padding: 0 2rem;
    }

    .question-content-inner {
        min-height: 0;
    }

    .question-card.expanded .question-content {
        grid-template-rows: 1fr;
        padding: 0 2rem 2rem 2rem;
    }

    .answer-option {
        padding: 1rem 1.5rem;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        margin-bottom: 0.75rem;
        background: white;
        transition: all 0.2s ease;
    }

    .answer-option.user-answer {
        border-color: #3b82f6;
        background: #dbeafe;
        font-weight: 600;
    }

    .answer-option.user-answer.incorrect {
        border-color: #ef4444;
        background: #fee2e2;
    }

    .answer-option.correct-answer {
        border-color: #10b981;
        background: #d1fae5;
        font-weight: 600;
    }

    .answer-label {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        color: #1f2937;
    }

    .answer-icon {
        font-size: 1.25rem;
    }

    /* Share Section */
    .share-section {
        background: white;
        border-radius: 20px;
        padding: 2.5rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        text-align: center;
        margin-bottom: 2rem;
    }

    .share-title {
        font-size: 1.75rem;
        font-weight: 800;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .share-description {
        color: #6b7280;
        font-size: 1rem;
        margin-bottom: 2rem;
    }

    .share-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .share-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem 2rem;
        border-radius: 12px;
        font-weight: 700;
        font-size: 1rem;
        text-decoration: none;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .share-btn-whatsapp {
        background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
        color: white;
    }

    .share-btn-whatsapp:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
    }

    .share-btn-twitter {
        background: linear-gradient(135deg, #1DA1F2 0%, #0d8bd9 100%);
        color: white;
    }

    .share-btn-twitter:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(29, 161, 242, 0.4);
    }

    .share-icon {
        width: 24px;
        height: 24px;
    }

    /* Products Section */
    .products-section {
        background: white;
        border-radius: 20px;
        padding: 2.5rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
    }

    .products-header {
        text-align: center;
        margin-bottom: 2.5rem;
    }

    .products-title {
        font-size: 1.75rem;
        font-weight: 800;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .products-description {
        color: #6b7280;
        font-size: 1rem;
    }

    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
    }

    .product-card {
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.3s ease;
        text-decoration: none;
        display: block;
    }

    .product-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        border-color: #3b82f6;
    }

    .product-image-wrapper {
        position: relative;
        width: 100%;
        padding-top: 75%;
        background: #f9fafb;
        overflow: hidden;
    }

    .product-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .product-info {
        padding: 1.5rem;
    }

    .product-title {
        font-size: 1rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.75rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .product-price {
        font-size: 1.5rem;
        font-weight: 800;
        color: #10b981;
        margin-bottom: 1rem;
    }

    .product-button {
        width: 100%;
        padding: 0.75rem;
        background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
        color: white;
        border-radius: 8px;
        font-weight: 700;
        text-align: center;
        transition: all 0.3s ease;
    }

    .product-card:hover .product-button {
        background: linear-gradient(135deg, #2563eb 0%, #0891b2 100%);
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 0;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem 2rem;
        border-radius: 12px;
        font-weight: 700;
        font-size: 1rem;
        text-decoration: none;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
    }

    .btn-primary {
        background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
    }

    .btn-secondary {
        background: white;
        color: #3b82f6;
        border: 2px solid #3b82f6;
    }

    .btn-secondary:hover {
        background: #f0f4ff;
        transform: translateY(-2px);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .result-title {
            font-size: 1.75rem;
        }

        .score-display {
            font-size: 3rem;
            padding: 1rem 2rem;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }

        .content-wrapper {
            padding: 2rem 1rem;
        }

        .breadcrumb-content {
            padding: 0 1rem;
        }

        .result-hero {
            padding: 3rem 1rem;
        }

        .review-section {
            padding: 1.5rem;
        }

        .question-header {
            flex-wrap: wrap;
            padding: 1.25rem 1.5rem;
        }

        .question-number {
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }

        .question-text {
            font-size: 1rem;
            flex: 1;
            min-width: 0;
        }

        .question-status {
            order: 4;
            width: 100%;
            margin-top: 0.75rem;
        }

        .question-toggle {
            order: 3;
        }

        .question-content {
            padding: 0 1.5rem;
        }

        .question-card.expanded .question-content {
            padding: 0 1.5rem 1.5rem 1.5rem;
        }

        .answer-option {
            padding: 0.75rem 1rem;
        }

        .share-buttons {
            flex-direction: column;
        }

        .share-btn {
            width: 100%;
            justify-content: center;
        }

        .action-buttons {
            flex-direction: column;
        }

        .btn {
            width: 100%;
            justify-content: center;
        }

        .products-section {
            padding: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<div class="breadcrumb">
    <div class="breadcrumb-content">
        <a href="{% url 'quizzes:home' %}" class="breadcrumb-link">
            🏠 Início
        </a>
        <span class="breadcrumb-separator">›</span>
        {% for item in breadcrumb %}
            <a href="{% url 'quizzes:theme_detail' theme_slug=item.slug %}" class="breadcrumb-link">
                {{ item.title }}
            </a>
            <span class="breadcrumb-separator">›</span>
        {% endfor %}
        <a href="{% url 'quizzes:quiz_detail' theme_slug=quiz.theme.slug quiz_slug=quiz.slug %}" class="breadcrumb-link">
            {{ quiz.title }}
        </a>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-current">Resultado</span>
    </div>
</div>

<!-- Result Hero -->
<div class="result-hero {{ performance_level }}">
    <div class="result-hero-content">
        <div class="result-icon">{{ performance_icon }}</div>
        <h1 class="result-title">{{ performance_message }}</h1>
        <p class="result-subtitle">{{ quiz.title }}</p>
        <div class="score-display">{{ percentage }}%</div>
        <div class="score-label">{{ total_score }} de {{ total_questions }} questões corretas</div>
    </div>
</div>

<!-- Main Content -->
<div class="content-wrapper">
    <!-- Stats Grid -->
    <div class="stats-grid">
        <!-- Ranking Position -->
        <div class="stat-card">
            <div class="stat-card-header">
                <div class="stat-icon rank">
                    {% if user_rank == 1 %}🥇
                    {% elif user_rank == 2 %}🥈
                    {% elif user_rank == 3 %}🥉
                    {% else %}🏆{% endif %}
                </div>
                <div class="stat-content">
                    <div class="stat-label">Sua Posição</div>
                    <div class="stat-value">{{ user_rank }}º</div>
                </div>
            </div>
            {% if user_rank == 1 %}
                <div class="stat-badge top3">⭐ Você está em 1º lugar!</div>
            {% elif user_rank <= 3 %}
                <div class="stat-badge top3">🔥 Top 3!</div>
            {% elif user_rank <= 10 %}
                <div class="stat-badge top10">⚡ Top 10!</div>
            {% elif users_beaten_percentage >= 50 %}
                <div class="stat-badge average">💪 Acima da média!</div>
            {% endif %}
        </div>

        <!-- Total Participants -->
        <div class="stat-card">
            <div class="stat-card-header">
                <div class="stat-icon users">👥</div>
                <div class="stat-content">
                    <div class="stat-label">Participantes</div>
                    <div class="stat-value">{{ total_attempts }}</div>
                </div>
            </div>
            <p style="color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem;">
                Total de pessoas que fizeram este quiz
            </p>
        </div>

        <!-- Users Beaten -->
        {% if users_beaten_percentage > 0 %}
        <div class="stat-card">
            <div class="stat-card-header">
                <div class="stat-icon beat">📈</div>
                <div class="stat-content">
                    <div class="stat-label">Superados</div>
                    <div class="stat-value">{{ users_beaten_percentage }}%</div>
                </div>
            </div>
            <p style="color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem;">
                Você está melhor que {{ users_beaten_percentage }}% dos participantes
            </p>
        </div>
        {% endif %}
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <form method="POST" action="{% url 'quizzes:quiz_start' theme_slug=quiz.theme.slug quiz_slug=quiz.slug %}" style="margin: 0;">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary">
                🔄 Jogar novamente
            </button>
        </form>
        <a href="{% url 'quizzes:theme_detail' theme_slug=quiz.theme.slug %}" class="btn btn-secondary">
            📚 Mais quizzes
        </a>
    </div>

    <!-- Share Section -->
    <div class="share-section">
        <h2 class="share-title">🎉 Compartilhe seu resultado!</h2>
        <p class="share-description">Mostre para seus amigos como você se saiu</p>
        <div class="share-buttons">
            <a href="#" class="share-btn share-btn-whatsapp" id="shareWhatsApp">
                <svg class="share-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                </svg>
                <span>WhatsApp</span>
            </a>
            <a href="#" class="share-btn share-btn-twitter" id="shareTwitter" target="_blank">
                <svg class="share-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
                <span>Twitter</span>
            </a>
        </div>
    </div>

    <!-- Products Section -->
    {% if products %}
    <div class="products-section">
        <div class="products-header">
            <h2 class="products-title">🛍️ Você também pode gostar</h2>
            <p class="products-description">Produtos selecionados especialmente para você</p>
        </div>
        <div class="products-grid">
            {% for product in products %}
            <a href="{{ product.product_url }}" target="_blank" class="product-card">
                <div class="product-image-wrapper">
                    <img src="{{ product.image_url }}" alt="{{ product.title }}" class="product-image">
                </div>
                <div class="product-info">
                    <div class="product-title">{{ product.title }}</div>
                    <div class="product-price">R$ {{ product.price }}</div>
                    <div class="product-button">Ver produto →</div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Review Section -->
    <div class="review-section">
        <div class="review-header">
            <h2 class="review-title">📝 Revisão das Respostas</h2>
            <p class="review-description">Veja as questões e confira suas respostas</p>
        </div>

        {% for result in results %}
        <div class="question-card {% if result.user_answer.is_correct %}correct{% else %}incorrect{% endif %}" data-question="{{ forloop.counter }}">
            <div class="question-header" onclick="toggleQuestion(this)">
                <div class="question-number">{{ forloop.counter }}</div>
                <div class="question-text">{{ result.question.text }}</div>
                <div class="question-status {% if result.user_answer.is_correct %}correct{% else %}incorrect{% endif %}">
                    {% if result.user_answer.is_correct %}
                        ✓ Correto
                    {% else %}
                        ✗ Incorreto
                    {% endif %}
                </div>
                <div class="question-toggle">▼</div>
            </div>

            <div class="question-content">
                <div class="question-content-inner">
                    {% if result.question.image %}
                    <div style="margin-bottom: 1.5rem; text-align: center;">
                        <img src="{{ result.question.image }}" alt="Imagem da questão" style="max-width: 100%; height: auto; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                    </div>
                    {% endif %}

                    <div class="answers-list">
                        {% for answer in result.all_answers %}
                        <div class="answer-option 
                            {% if result.user_answer.selected_answer.id == answer.id %}
                                user-answer {% if not result.user_answer.is_correct %}incorrect{% endif %}
                            {% endif %}
                            {% if answer.is_correct %}
                                correct-answer
                            {% endif %}">
                            <div class="answer-label">
                                {% if result.user_answer.selected_answer.id == answer.id %}
                                    {% if result.user_answer.is_correct %}
                                        <span class="answer-icon">✓</span>
                                    {% else %}
                                        <span class="answer-icon">✗</span>
                                    {% endif %}
                                {% elif answer.is_correct %}
                                    <span class="answer-icon">✓</span>
                                {% endif %}
                                <span>{{ answer.text }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    // Toggle Question Accordion
    function toggleQuestion(header) {
        const card = header.parentElement;
        card.classList.toggle('expanded');
    }

    // Share on WhatsApp
    document.getElementById('shareWhatsApp').addEventListener('click', function(e) {
        e.preventDefault();
        const quizTitle = '{{ quiz.title|escapejs }}';
        const percentage = '{{ percentage }}';
        const rank = '{{ user_rank }}';
        const totalAttempts = '{{ total_attempts }}';
        const url = window.location.origin + '{% url "quizzes:quiz_detail" theme_slug=quiz.theme.slug quiz_slug=quiz.slug %}';
        
        const message = 'Acabei de fazer o quiz "' + quizTitle + '" e consegui ' + percentage + '% de acertos! Fiquei em ' + rank + 'º lugar de ' + totalAttempts + ' participantes. Faca voce tambem: ' + url;
        
        const whatsappUrl = 'https://wa.me/?text=' + encodeURIComponent(message);
        window.open(whatsappUrl, '_blank');
    });

    // Share on Twitter
    document.getElementById('shareTwitter').addEventListener('click', function(e) {
        e.preventDefault();
        const quizTitle = '{{ quiz.title|escapejs }}';
        const percentage = '{{ percentage }}';
        const rank = '{{ user_rank }}';
        const totalAttempts = '{{ total_attempts }}';
        const url = window.location.origin + '{% url "quizzes:quiz_detail" theme_slug=quiz.theme.slug quiz_slug=quiz.slug %}';
        
        const message = 'Acabei de fazer o quiz "' + quizTitle + '" e consegui ' + percentage + '% de acertos! Fiquei em ' + rank + 'º lugar de ' + totalAttempts + ' participantes.';
        
        const twitterUrl = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(message) + '&url=' + encodeURIComponent(url);
        window.open(twitterUrl, '_blank');
    });
</script>
{% endblock %}

{% load static %}
{% load translations %}

<!-- Products Section - Carousel -->
{% if products %}
<style>
    /* Products Section - Carousel */
    .carousel-section {
        margin-bottom: 2rem;
    }

    .carousel-container {
        position: relative;
        background: var(--card-bg);
        border-radius: 24px;
        padding: 40px 20px;
        box-shadow: var(--shadow-lg);
        overflow: visible;
        transition: background 0.3s ease, box-shadow 0.3s ease;
    }

    .carousel-header {
        text-align: center;
        margin-bottom: 40px;
        padding: 0 20px;
    }

    .carousel-header h1 {
        font-size: 2rem;
        color: var(--text-primary);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        font-weight: 800;
        transition: color 0.3s ease;
    }

    .carousel-header h1::before {
        content: "üõçÔ∏è";
        font-size: 2rem;
    }

    .carousel-header p {
        color: var(--text-secondary);
        font-size: 1rem;
        transition: color 0.3s ease;
    }

    .carousel-wrapper {
        overflow: hidden;
        margin: 0 60px;
        padding: 10px 0;
    }

    .carousel-track {
        display: flex;
        transition: transform 0.5s ease-in-out;
    }

    .carousel-item {
        min-width: calc(33.333% - 20px);
        margin: 0 10px;
        flex-shrink: 0;
    }

    .product-card {
        background: var(--bg-secondary);
        border-radius: 16px;
        padding: 20px;
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
        border: 2px solid transparent;
        text-decoration: none;
        display: block;
        color: inherit;
        position: relative;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
        border-color: #3b82f6;
    }

    .product-discount-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        animation: pulse-badge 2s ease-in-out infinite;
        z-index: 2;
    }

    @keyframes pulse-badge {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
    }

    .product-image {
        width: 100%;
        height: 250px;
        object-fit: cover;
        border-radius: 12px;
        margin-bottom: 20px;
        background: #f3f4f6;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .product-name {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        min-height: 50px;
        transition: color 0.3s ease;
    }

    .product-price {
        font-size: 1.8rem;
        font-weight: 700;
        color: #10b981;
        margin-bottom: 20px;
    }

    .product-button {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        border: none;
        padding: 14px 32px;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        display: block;
    }

    .product-button:hover {
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
    }

    .carousel-button {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: var(--card-bg);
        border: 2px solid var(--border-color);
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 10;
        box-shadow: var(--shadow-sm);
        color: var(--text-primary);
    }

    .carousel-button:hover {
        background: #3b82f6;
        border-color: #3b82f6;
        transform: translateY(-50%) scale(1.1);
    }

    .carousel-button:hover svg {
        stroke: white;
    }

    .carousel-button svg {
        stroke: var(--text-primary);
        transition: stroke 0.3s ease;
    }

    .carousel-button.prev {
        left: 10px;
    }

    .carousel-button.next {
        right: 10px;
    }

    .carousel-dots {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 30px;
    }

    .dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #cbd5e0;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .dot.active {
        background: #3b82f6;
        width: 32px;
        border-radius: 6px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .carousel-container {
            padding: 30px 15px;
        }

        .carousel-header {
            margin-bottom: 30px;
            padding: 0 10px;
        }

        .carousel-header h1 {
            font-size: 1.5rem;
        }

        .carousel-header h1::before {
            font-size: 1.5rem;
        }

        .carousel-header p {
            font-size: 0.9rem;
        }

        .carousel-item {
            min-width: 100%;
        }

        .carousel-wrapper {
            margin: 0 50px;
        }

        .product-image {
            height: 200px;
        }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
        .carousel-item {
            min-width: calc(50% - 20px);
        }
    }
</style>

<div class="carousel-section">
    <div class="carousel-container">
        <div class="carousel-header">
            <h1>{% t 'you_may_also_like' %}</h1>
            <p>{% t 'products_selected_for_you' %}</p>
        </div>

        <div class="carousel-wrapper">
            <div class="carousel-track" id="carouselTrack">
                {% for product in products %}
                <div class="carousel-item">
                    <a href="{{ product.product_url }}" target="_blank" class="product-card">
                        {% if product.discount_percentage %}
                        <span class="product-discount-badge">-{{ product.discount_percentage }}% {% t 'discount' %}</span>
                        {% endif %}
                        <img src="{{ product.image_url }}" alt="{{ product.title }}" class="product-image">
                        <h3 class="product-name">{{ product.title }}</h3>
                        <p class="product-price">{% t 'currency_symbol' %} {{ product.price }}</p>
                        <span class="product-button">{% t 'view_product' %} ‚Üí</span>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>

        <button class="carousel-button prev" onclick="moveCarousel(-1)">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        </button>

        <button class="carousel-button next" onclick="moveCarousel(1)">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </button>

        <div class="carousel-dots" id="carouselDots"></div>
    </div>
</div>

<script>
// Products Carousel functionality
(function() {
    function initCarousel() {
        let currentIndex = 0;
        const track = document.getElementById('carouselTrack');
        const items = document.querySelectorAll('.carousel-item');
        const dotsContainer = document.getElementById('carouselDots');
        let autoplayInterval;
        
        if (!track || !items.length || !dotsContainer) return;
        
        // Calcular items vis√≠veis baseado na largura da tela
        function getVisibleItems() {
            if (window.innerWidth <= 768) return 1;
            if (window.innerWidth <= 1024) return 2;
            return 3;
        }

        function getTotalSlides() {
            return Math.max(1, items.length - getVisibleItems() + 1);
        }

        // Criar dots
        function createDots() {
            dotsContainer.innerHTML = '';
            const totalSlides = getTotalSlides();
            for (let i = 0; i < totalSlides; i++) {
                const dot = document.createElement('div');
                dot.className = i === 0 ? 'dot active' : 'dot';
                dot.onclick = () => goToSlide(i);
                dotsContainer.appendChild(dot);
            }
        }

        function updateCarousel() {
            if (items.length === 0) return;
            
            const itemWidth = items[0].offsetWidth + 20; // width + margin
            track.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
            
            // Update dots
            const dots = document.querySelectorAll('.dot');
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentIndex);
            });
        }

        window.moveCarousel = function(direction) {
            const totalSlides = getTotalSlides();
            currentIndex += direction;
            
            if (currentIndex < 0) {
                currentIndex = 0;
            } else if (currentIndex >= totalSlides) {
                currentIndex = totalSlides - 1;
            }
            
            updateCarousel();
        }

        function goToSlide(index) {
            currentIndex = index;
            updateCarousel();
        }

        function startAutoplay() {
            autoplayInterval = setInterval(() => {
                const totalSlides = getTotalSlides();
                if (currentIndex >= totalSlides - 1) {
                    currentIndex = 0;
                } else {
                    currentIndex++;
                }
                updateCarousel();
            }, 5000);
        }

        function stopAutoplay() {
            clearInterval(autoplayInterval);
        }

        // Auto-play
        startAutoplay();

        // Pausar autoplay ao passar o mouse
        const container = document.querySelector('.carousel-container');
        if (container) {
            container.addEventListener('mouseenter', stopAutoplay);
            container.addEventListener('mouseleave', startAutoplay);
        }

        // Recalcular ao redimensionar
        window.addEventListener('resize', () => {
            createDots();
            updateCarousel();
        });

        // Inicializar
        createDots();
        updateCarousel();
    }

    // Inicializar quando o DOM estiver pronto
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initCarousel);
    } else {
        // DOM j√° est√° pronto
        initCarousel();
    }
})();
</script>
{% endif %}
